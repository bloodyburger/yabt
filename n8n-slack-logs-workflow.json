{
  "name": "YABT Logs to Slack",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "yabt-logs",
        "responseMode": "onReceived",
        "responseData": "allEntries",
        "options": {}
      },
      "id": "webhook-node",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 300],
      "webhookId": "yabt-logs"
    },
    {
      "parameters": {
        "jsCode": "// Format log for Slack\nconst log = $input.first().json;\n\n// Color based on log level\nconst colors = {\n  error: '#e74c3c',\n  warn: '#f39c12',\n  info: '#3498db',\n  debug: '#95a5a6'\n};\n\nconst emojis = {\n  error: 'ðŸš¨',\n  warn: 'âš ï¸',\n  info: 'â„¹ï¸',\n  debug: 'ðŸ”'\n};\n\nconst level = log.level || 'info';\nconst color = colors[level] || colors.info;\nconst emoji = emojis[level] || emojis.info;\n\n// Build Slack message blocks\nconst blocks = [\n  {\n    type: 'header',\n    text: {\n      type: 'plain_text',\n      text: `${emoji} YABT ${level.toUpperCase()} Log`,\n      emoji: true\n    }\n  },\n  {\n    type: 'divider'\n  },\n  {\n    type: 'section',\n    fields: [\n      {\n        type: 'mrkdwn',\n        text: `*Message:*\\n${log.message || 'No message'}`\n      },\n      {\n        type: 'mrkdwn',\n        text: `*Timestamp:*\\n${log.timestamp || new Date().toISOString()}`\n      }\n    ]\n  }\n];\n\n// Add request details if present\nif (log.requestId || log.method || log.path) {\n  blocks.push({\n    type: 'section',\n    fields: [\n      {\n        type: 'mrkdwn',\n        text: `*Request ID:*\\n\\`${log.requestId || 'N/A'}\\``\n      },\n      {\n        type: 'mrkdwn',\n        text: `*Endpoint:*\\n\\`${log.method || ''} ${log.path || ''}\\``\n      }\n    ]\n  });\n}\n\n// Add status code and response time if present\nif (log.statusCode || log.responseTime) {\n  blocks.push({\n    type: 'section',\n    fields: [\n      {\n        type: 'mrkdwn',\n        text: `*Status:*\\n${log.statusCode || 'N/A'}`\n      },\n      {\n        type: 'mrkdwn',\n        text: `*Response Time:*\\n${log.responseTime || 'N/A'}`\n      }\n    ]\n  });\n}\n\n// Add IP and User Agent if present\nif (log.ip || log.userAgent) {\n  blocks.push({\n    type: 'section',\n    fields: [\n      {\n        type: 'mrkdwn',\n        text: `*IP:*\\n${log.ip || 'N/A'}`\n      },\n      {\n        type: 'mrkdwn',\n        text: `*User Agent:*\\n${(log.userAgent || 'N/A').substring(0, 100)}${log.userAgent && log.userAgent.length > 100 ? '...' : ''}`\n      }\n    ]\n  });\n}\n\n// Add error details if present\nif (log.error || log.stack) {\n  blocks.push({\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `*Error Details:*\\n\\`\\`\\`${log.error || ''}\\n${log.stack ? log.stack.substring(0, 500) : ''}\\`\\`\\``\n    }\n  });\n}\n\n// Add request/response body if present (truncated)\nif (log.body) {\n  const bodyStr = typeof log.body === 'string' ? log.body : JSON.stringify(log.body, null, 2);\n  blocks.push({\n    type: 'section',\n    text: {\n      type: 'mrkdwn',\n      text: `*Body:*\\n\\`\\`\\`${bodyStr.substring(0, 500)}${bodyStr.length > 500 ? '...' : ''}\\`\\`\\``\n    }\n  });\n}\n\n// Add divider before context\nblocks.push({ type: 'divider' });\n\n// Add environment info\nblocks.push({\n  type: 'context',\n  elements: [\n    {\n      type: 'mrkdwn',\n      text: `Service: *${log.service || 'yabt'}* | Environment: *${log.environment || 'production'}*`\n    }\n  ]\n});\n\nreturn {\n  json: {\n    channel: '#yabt-logs',\n    blocks: blocks,\n    text: `${emoji} YABT ${level.toUpperCase()}: ${log.message || 'Log event'}`\n  }\n};"
      },
      "id": "code-node",
      "name": "Format for Slack",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [470, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "post",
        "channel": {
          "__rl": true,
          "mode": "name",
          "value": "={{ $json.channel }}"
        },
        "messageType": "block",
        "blocksUi": "={{ JSON.stringify($json.blocks) }}",
        "text": "={{ $json.text }}",
        "otherOptions": {}
      },
      "id": "slack-node",
      "name": "Send to Slack",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [690, 300],
      "credentials": {
        "slackApi": {
          "id": "YOUR_SLACK_CREDENTIAL_ID",
          "name": "Slack Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "filter-level",
              "leftValue": "={{ $json.level }}",
              "rightValue": "debug",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-node",
      "name": "Filter Debug Logs",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [360, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Filter Debug Logs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Debug Logs": {
      "main": [
        [
          {
            "node": "Format for Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format for Slack": {
      "main": [
        [
          {
            "node": "Send to Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-12-29T09:28:00.000Z",
  "versionId": "2"
}
